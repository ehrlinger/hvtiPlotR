<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Plot Mirrored Propensity Score Histogram — plot_mirror_histogram • hvtiPlotR</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Outfit-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot Mirrored Propensity Score Histogram — plot_mirror_histogram"><meta name="description" content="Generates mirrored propensity score histograms for two treatment groups,
highlighting the distribution before and after matching. The returned list
contains the rendered plot, the filtered data used to draw it, and a set of
diagnostics (group counts, SMD values, summary statistics) that can be logged
or displayed in reports."><meta property="og:description" content="Generates mirrored propensity score histograms for two treatment groups,
highlighting the distribution before and after matching. The returned list
contains the rendered plot, the filtered data used to draw it, and a set of
diagnostics (group counts, SMD values, summary statistics) that can be logged
or displayed in reports."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hvtiPlotR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hvtiPlotR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ehrlinger/hvtiPlotR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.linkedin.com/in/ehrlinger/" aria-label="LinkedIn"><span class="fa fa-linkedin"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Plot Mirrored Propensity Score Histogram</h1>
      <small class="dont-index">Source: <a href="https://github.com/ehrlinger/hvtiPlotR/blob/main/R/mirror-histogram.R" class="external-link"><code>R/mirror-histogram.R</code></a></small>
      <div class="d-none name"><code>plot_mirror_histogram.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates mirrored propensity score histograms for two treatment groups,
highlighting the distribution before and after matching. The returned list
contains the rendered plot, the filtered data used to draw it, and a set of
diagnostics (group counts, SMD values, summary statistics) that can be logged
or displayed in reports.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">plot_mirror_histogram</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  score_col <span class="op">=</span> <span class="st">"prob_t"</span>,</span>
<span>  group_col <span class="op">=</span> <span class="st">"tavr"</span>,</span>
<span>  match_col <span class="op">=</span> <span class="st">"match"</span>,</span>
<span>  group_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  group_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SAVR"</span>, <span class="st">"TF-TAVR"</span><span class="op">)</span>,</span>
<span>  matched_value <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  score_multiplier <span class="op">=</span> <span class="va">HVTI_SCORE_DEFAULT_MULTIPLIER</span>,</span>
<span>  binwidth <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  output_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame containing at least the score, group, and match
indicators.</p></dd>


<dt id="arg-score-col">score_col<a class="anchor" aria-label="anchor" href="#arg-score-col"></a></dt>
<dd><p>Column name holding the numeric propensity score.</p></dd>


<dt id="arg-group-col">group_col<a class="anchor" aria-label="anchor" href="#arg-group-col"></a></dt>
<dd><p>Column name identifying the grouping/treatment indicator.</p></dd>


<dt id="arg-match-col">match_col<a class="anchor" aria-label="anchor" href="#arg-match-col"></a></dt>
<dd><p>Column name indicating whether an observation is matched.</p></dd>


<dt id="arg-group-levels">group_levels<a class="anchor" aria-label="anchor" href="#arg-group-levels"></a></dt>
<dd><p>Length-2 vector giving the values in `group_col` that
should be plotted (order determines the panel orientation).</p></dd>


<dt id="arg-group-labels">group_labels<a class="anchor" aria-label="anchor" href="#arg-group-labels"></a></dt>
<dd><p>Length-2 character vector supplying human readable labels
for each group.</p></dd>


<dt id="arg-matched-value">matched_value<a class="anchor" aria-label="anchor" href="#arg-matched-value"></a></dt>
<dd><p>Value in `match_col` that denotes a matched observation.</p></dd>


<dt id="arg-score-multiplier">score_multiplier<a class="anchor" aria-label="anchor" href="#arg-score-multiplier"></a></dt>
<dd><p>Multiplier applied to `score_col` prior to plotting
(defaults to percentages).</p></dd>


<dt id="arg-binwidth">binwidth<a class="anchor" aria-label="anchor" href="#arg-binwidth"></a></dt>
<dd><p>Bin width, on the scaled score scale, used when computing the
histograms.</p></dd>


<dt id="arg-output-file">output_file<a class="anchor" aria-label="anchor" href="#arg-output-file"></a></dt>
<dd><p>Optional file path for saving the figure via `ggsave()`.</p></dd>


<dt id="arg-width-height">width, height<a class="anchor" aria-label="anchor" href="#arg-width-height"></a></dt>
<dd><p>Dimensions (inches) used when saving `output_file`.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with elements `plot` (ggplot object), `diagnostics` (list of
  summary statistics), and `data` (the filtered data frame that was plotted).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a sample data set</span></span></span>
<span class="r-in"><span><span class="va">mirror_dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="sample_mirror_histogram_data.html">sample_mirror_histogram_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the figure</span></span></span>
<span class="r-in"><span><span class="va">mhist</span> <span class="op">&lt;-</span> <span class="fu">plot_mirror_histogram</span><span class="op">(</span><span class="va">mirror_dta</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The plot is returned in a list.</span></span></span>
<span class="r-in"><span><span class="va">mhist</span><span class="op">$</span><span class="va">p</span></span></span>
<span class="r-plt img"><img src="plot_mirror_histogram-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Diagnostics are also returned, which can be logged or displayed in reports.</span></span></span>
<span class="r-in"><span><span class="va">mhist</span><span class="op">$</span><span class="va">diagnostics</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_input</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 8000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_analyzed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 8000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_dropped_missing_or_other_group</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $group_counts_before</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    0    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4000 4000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $group_counts_matched</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    0    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2438 2359 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $matched_rate_by_group</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       0       1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.60950 0.58975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $score_summary_before</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> working$group: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.506  16.432  26.597  28.661  38.997  89.089 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> working$group: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5.868  60.964  73.585  71.312  84.054  99.760 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $score_summary_matched</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> working$group[matched_idx]: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.506  16.516  26.585  28.827  39.346  83.929 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> working$group[matched_idx]: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5.868  60.922  73.683  71.229  83.943  99.760 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $smd_before</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.648481</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $smd_matched</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.605724</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The data used to draw the figure is also returned, which can be useful for</span></span></span>
<span class="r-in"><span><span class="co"># debugging or further analysis.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mhist</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   score_raw group matched    score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.1855938     0       0 18.55938</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.2414701     0       1 24.14701</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.6889674     0       1 68.89674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.3001684     0       1 30.01684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.3125460     0       0 31.25460</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.3879990     0       1 38.79990</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By default, the figure uses the manuscript theme, but you can set it to</span></span></span>
<span class="r-in"><span><span class="co"># any hvtiPlotR theme you like. For example:</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">set_theme</a></span><span class="op">(</span><span class="fu"><a href="hvti_theme.html">hvti_theme</a></span><span class="op">(</span><span class="st">"manuscript"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mhist</span><span class="op">$</span><span class="va">p</span></span></span>
<span class="r-plt img"><img src="plot_mirror_histogram-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can modify the figure using scales:</span></span></span>
<span class="r-in"><span><span class="va">mhist</span><span class="op">$</span><span class="va">p</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      before_g0 <span class="op">=</span> <span class="st">"white"</span>,</span></span>
<span class="r-in"><span>      matched_g0 <span class="op">=</span> <span class="st">"green1"</span>,</span></span>
<span class="r-in"><span>      before_g1 <span class="op">=</span> <span class="st">"white"</span>,</span></span>
<span class="r-in"><span>      matched_g1 <span class="op">=</span> <span class="st">"green4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scale for <span style="color: #00BB00;">fill</span> is already present.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span>
<span class="r-plt img"><img src="plot_mirror_histogram-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span> <span class="co"># and annotations:</span></span></span>
<span class="r-in"><span><span class="va">group_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SAVR"</span>, <span class="st">"TF-TAVR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mhist</span><span class="op">$</span><span class="va">p</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      before_g0 <span class="op">=</span> <span class="st">"white"</span>,</span></span>
<span class="r-in"><span>      matched_g0 <span class="op">=</span> <span class="st">"green1"</span>,</span></span>
<span class="r-in"><span>      before_g1 <span class="op">=</span> <span class="st">"white"</span>,</span></span>
<span class="r-in"><span>      matched_g1 <span class="op">=</span> <span class="st">"green4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"text"</span>,</span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="fl">0.8</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="fl">0.80</span>,</span></span>
<span class="r-in"><span>    label <span class="op">=</span> <span class="va">group_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    size <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"text"</span>,</span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="fl">0.8</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="op">-</span><span class="fl">0.80</span>,</span></span>
<span class="r-in"><span>    label <span class="op">=</span> <span class="va">group_labels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    size <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scale for <span style="color: #00BB00;">fill</span> is already present.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span>
<span class="r-plt img"><img src="plot_mirror_histogram-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>John Ehrlinger</p>
</div>

<div class="pkgdown-footer-right">
  <p>This site was built using <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>!  <img src="https://pkgdown.r-lib.org/logo.png" alt="pkgdown logo" width="25"></p>
</div>

    </footer></div>





  </body></html>

